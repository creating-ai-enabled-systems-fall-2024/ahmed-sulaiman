import numpy as np

def compute_loss(prediction, annotation):
    return np.mean((np.array(prediction) - np.array(annotation))**2)

def sample_hard_negatives(prediction_dir, annotation_dir, num_samples):
    predictions = np.load(prediction_dir)
    annotations = np.load(annotation_dir)
    
    losses = [compute_loss(pred, ann) for pred, ann in zip(predictions, annotations)]
    
    hardest_indices = np.argsort(losses)[-num_samples:]
    
    hard_negatives = [predictions[i] for i in hardest_indices]
    return hard_negatives

def image_entropy(image):
    hist = np.histogram(image, bins=256)[0]
    hist = hist / hist.sum()
    entropy = -np.sum(hist * np.log2(hist + 1e-7))  
    return entropy